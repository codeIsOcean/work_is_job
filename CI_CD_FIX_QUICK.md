# –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ CI/CD

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω

- Push –≤ –≤–µ—Ç–∫—É `test` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `/opt/jobs_inDubai_testBot` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `docker compose -f docker-compose.test.yml up -d --build`.
- Push –≤ –≤–µ—Ç–∫—É `main` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ –∂–µ —à–∞–≥–∏ –Ω–∞ `/opt/jobs_inDubai_prod`, –∏—Å–ø–æ–ª—å–∑—É—è `docker-compose.prod.yml`.
- –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä—è–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö, –æ—Ç–¥–µ–ª—å–Ω—ã–π registry –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω.

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

### 1. –§–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö

–°–æ–∑–¥–∞–π –∏ –∑–∞–ø–æ–ª–Ω–∏ –≤—Ä—É—á–Ω—É—é:

- `/opt/jobs_inDubai_testBot/.env.test` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.test.example`.
- `/opt/jobs_inDubai_prod/.env.prod` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.prod.example`.

–≠—Ç–∏ —Ñ–∞–π–ª—ã –Ω–µ –∫–æ–º–º–∏—Ç–∏–º ‚Äî –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏.

### 2. GitHub Secrets

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Ç–∫—Ä–æ–π `Settings ‚Üí Secrets and variables ‚Üí Actions` –∏ —Å–æ–∑–¥–∞–π:

#### –î–ª—è —Ç–µ—Å—Ç–∞ (`test`)
- `TEST_SERVER_HOST`
- `TEST_SERVER_USER`
- `TEST_SERVER_SSH_KEY`

#### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ (`main`)
- `PROD_SERVER_HOST`
- `PROD_SERVER_USER`
- `PROD_SERVER_SSH_KEY`

### 3. –ì–¥–µ –≤–∑—è—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (–µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª—Å—è)

```powershell
ssh root@88.210.35.183 "cat ~/.ssh/github_actions_deploy"
```

–°–∫–æ–ø–∏—Ä—É–π –≤—ã–≤–æ–¥ –≤–º–µ—Å—Ç–µ —Å `-----BEGIN` –∏ `-----END`, –≤—Å—Ç–∞–≤—å –≤ –Ω—É–∂–Ω—ã–π secret.

## üö¶ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

```powershell
git checkout test
git add .
git commit -m "Test CI/CD"
git push origin test
```

–î–∞–ª—å—à–µ –æ—Ç–∫—Ä–æ–π GitHub ‚Üí `Actions` –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ job –ø—Ä–æ—à—ë–ª. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
docker compose -f docker-compose.test.yml ps
docker logs bot_test --tail 50
```

## üéØ –ò—Ç–æ–≥

CI/CD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–æ—Ç–∞ –∏–∑ –≤–µ—Ç–æ–∫ `test` –∏ `main`. –î–µ—Ä–∂–∏ `.env.test` / `.env.prod` –∏ GitHub secrets –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äî –æ—Å—Ç–∞–ª—å–Ω–æ–µ pipeline —Å–¥–µ–ª–∞–µ—Ç –∑–∞ —Ç–µ–±—è.

