warning: in the working copy of 'bot/services/visual_captcha_logic.py', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/.cursor/settings.json b/.cursor/settings.json[m
[1mindex 94d48ff..456cc4f 100644[m
[1m--- a/.cursor/settings.json[m
[1m+++ b/.cursor/settings.json[m
[36m@@ -33,3 +33,4 @@[m
 [m
 [m
 [m
[41m+[m
[1mdiff --git a/CURSOR_SETUP.md b/CURSOR_SETUP.md[m
[1mindex 1fbdb66..ba3d8c9 100644[m
[1m--- a/CURSOR_SETUP.md[m
[1m+++ b/CURSOR_SETUP.md[m
[36m@@ -105,3 +105,4 @@[m [mapril_test_bot_one/[m
 [m
 [m
 [m
[41m+[m
[1mdiff --git a/bot/services/visual_captcha_logic.py b/bot/services/visual_captcha_logic.py[m
[1mindex 4d88baf..36559c0 100644[m
[1m--- a/bot/services/visual_captcha_logic.py[m
[1m+++ b/bot/services/visual_captcha_logic.py[m
[36m@@ -23,7 +23,7 @@[m [mlogger = logging.getLogger(__name__)[m
 [m
 async def generate_visual_captcha() -> Tuple[str, BufferedInputFile]:[m
     """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∫–∞–ø—á–∏ (—á–∏—Å–ª–æ, —Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–æ—Å—Ç–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞)."""[m
[31m-    width, height = 800, 300  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏[m
[32m+[m[32m    width, height = 1000, 400  # –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤[m
     img = Image.new("RGB", (width, height), color=(255, 255, 255))[m
     d = ImageDraw.Draw(img)[m
 [m
[36m@@ -51,13 +51,20 @@[m [masync def generate_visual_captcha() -> Tuple[str, BufferedInputFile]:[m
         if not fonts:[m
             # –°–æ–∑–¥–∞–µ–º —à—Ä–∏—Ñ—Ç —Å –±–æ–ª—å—à–∏–º —Ä–∞–∑–º–µ—Ä–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ[m
             fonts = [][m
[31m-            for size in (100, 110, 120, 130):[m
[32m+[m[32m            for size in (80, 90, 100, 110):[m
                 try:[m
                     # –°–æ–∑–¥–∞–µ–º —à—Ä–∏—Ñ—Ç —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º[m
[31m-                    font = ImageFont.load_default()[m
[32m+[m[32m                    font = ImageFont.truetype("/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf", size)[m
                     fonts.append(font)[m
                 except:[m
[31m-                    fonts.append(ImageFont.load_default())[m
[32m+[m[32m                    try:[m
[32m+[m[32m                        # –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –ø—É—Ç—å[m
[32m+[m[32m                        font = ImageFont.truetype("/System/Library/Fonts/Arial.ttf", size)[m
[32m+[m[32m                        fonts.append(font)[m
[32m+[m[32m                    except:[m
[32m+[m[32m                        # –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º default, –Ω–æ —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º[m
[32m+[m[32m                        font = ImageFont.load_default()[m
[32m+[m[32m                        fonts.append(font)[m
             logger.warning("–°–æ–∑–¥–∞–Ω –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —à—Ä–∏—Ñ—Ç - —Å–∏–º–≤–æ–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä—É–ø–Ω—ã–º–∏")[m
             [m
     except Exception as e:[m
[36m@@ -111,11 +118,18 @@[m [masync def generate_visual_captcha() -> Tuple[str, BufferedInputFile]:[m
         angle = random.randint(-15, 15)[m
         font = random.choice(fonts)[m
 [m
[31m-        char_img = Image.new("RGBA", (150, 180), (255, 255, 255, 0))  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–æ–≤[m
[32m+[m[32m        char_img = Image.new("RGBA", (200, 240), (255, 255, 255, 0))  # –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–æ–≤[m
         char_draw = ImageDraw.Draw(char_img)[m
[31m-        color = (random.randint(0, 80), random.randint(0, 80), random.randint(0, 80))  # –ë–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç[m
[32m+[m[32m        color = (random.randint(0, 60), random.randint(0, 60), random.randint(0, 60))  # –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç[m
 [m
[31m-        char_draw.text((10, 10), ch, font=font, fill=color)  # –ë–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø[m
[32m+[m[32m        # –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç —Å –±–æ–ª—å—à–∏–º –æ—Ç—Å—Ç—É–ø–æ–º[m
[32m+[m[32m        char_draw.text((20, 20), ch, font=font, fill=color)[m
[32m+[m[41m        [m
[32m+[m[32m        # –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç –º–µ–ª–∫–∏–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ[m
[32m+[m[32m        if font == ImageFont.load_default():[m
[32m+[m[32m            # –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –≤ 3 —Ä–∞–∑–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏[m
[32m+[m[32m            char_img = char_img.resize((600, 720), Image.Resampling.LANCZOS)[m
[32m+[m[41m        [m
         rotated = char_img.rotate(angle, expand=1, fillcolor=(255, 255, 255, 0))[m
         y_pos = random.randint(height // 3, height // 2)  # –õ—É—á—à–µ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ[m
         img.paste(rotated, (x_offset, y_pos), rotated)[m
