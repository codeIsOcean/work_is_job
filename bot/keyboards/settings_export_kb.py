# ============================================================
# –ö–õ–ê–í–ò–ê–¢–£–†–´ –î–õ–Ø –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê –ù–ê–°–¢–†–û–ï–ö
# ============================================================
# –≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è:
# - –í—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
# - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
# - –û—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
# ============================================================

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∏–ø—ã –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º typing –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
from typing import List, Any


# ============================================================
# –ö–õ–ê–í–ò–ê–¢–£–†–´ –î–õ–Ø –≠–ö–°–ü–û–†–¢–ê
# ============================================================

def create_export_groups_keyboard(groups: List[Any]) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–æ —Å–ø–∏—Å–∫–æ–º –≥—Ä—É–ø–ø –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.

    –ö–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏ callback_data —Å chat_id.

    Args:
        groups: –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø (–æ–±—ä–µ–∫—Ç—ã —Å chat_id –∏ title)

    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≥—Ä—É–ø–ø
    """
    # –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ (–∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä—è–¥—É)
    buttons = []

    for group in groups:
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
        title = getattr(group, 'title', None) or f"–ì—Ä—É–ø–ø–∞ {group.chat_id}"

        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –Ω–∞–∑–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 30 —Å–∏–º–≤–æ–ª–æ–≤)
        if len(title) > 30:
            title = title[:27] + "..."

        # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É —Å callback_data —Å–æ–¥–µ—Ä–∂–∞—â–∏–º chat_id
        button = InlineKeyboardButton(
            text=f"üì§ {title}",
            callback_data=f"export_select:{group.chat_id}",
        )

        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä—è–¥
        buttons.append([button])

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ
    buttons.append([
        InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="export_cancel")
    ])

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    return InlineKeyboardMarkup(inline_keyboard=buttons)


def create_export_confirm_keyboard(chat_id: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞.

    Args:
        chat_id: ID –≥—Ä—É–ø–ø—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞

    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ—Ç–º–µ–Ω—ã
    """
    # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏
    buttons = [
        # –ü–µ—Ä–≤—ã–π —Ä—è–¥: –∫–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        [
            InlineKeyboardButton(
                text="‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",
                callback_data=f"export_confirm:{chat_id}",
            )
        ],
        # –í—Ç–æ—Ä–æ–π —Ä—è–¥: –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≥—Ä—É–ø–ø—ã
        [
            InlineKeyboardButton(
                text="üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º",
                callback_data=f"export_back:{chat_id}",
            )
        ],
    ]

    return InlineKeyboardMarkup(inline_keyboard=buttons)


# ============================================================
# –ö–õ–ê–í–ò–ê–¢–£–†–´ –î–õ–Ø –ò–ú–ü–û–†–¢–ê
# ============================================================

def create_import_groups_keyboard(groups: List[Any]) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–æ —Å–ø–∏—Å–∫–æ–º –≥—Ä—É–ø–ø –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞.

    –ö–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏ callback_data —Å chat_id.

    Args:
        groups: –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø (–æ–±—ä–µ–∫—Ç—ã —Å chat_id –∏ title)

    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≥—Ä—É–ø–ø
    """
    # –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ (–∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä—è–¥—É)
    buttons = []

    for group in groups:
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
        title = getattr(group, 'title', None) or f"–ì—Ä—É–ø–ø–∞ {group.chat_id}"

        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –Ω–∞–∑–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 30 —Å–∏–º–≤–æ–ª–æ–≤)
        if len(title) > 30:
            title = title[:27] + "..."

        # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É —Å callback_data —Å–æ–¥–µ—Ä–∂–∞—â–∏–º chat_id
        button = InlineKeyboardButton(
            text=f"üì• {title}",
            callback_data=f"import_select:{group.chat_id}",
        )

        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä—è–¥
        buttons.append([button])

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ
    buttons.append([
        InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="import_cancel")
    ])

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    return InlineKeyboardMarkup(inline_keyboard=buttons)


def create_import_confirm_keyboard(chat_id: int) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞.

    Args:
        chat_id: ID –≥—Ä—É–ø–ø—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ—Ç–º–µ–Ω—ã
    """
    # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏
    buttons = [
        # –ü–µ—Ä–≤—ã–π —Ä—è–¥: –∫–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        [
            InlineKeyboardButton(
                text="‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",
                callback_data=f"import_confirm:{chat_id}",
            )
        ],
        # –í—Ç–æ—Ä–æ–π —Ä—è–¥: –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≥—Ä—É–ø–ø—ã (—á–µ—Ä–µ–∑ FSM-aware callback)
        [
            InlineKeyboardButton(
                text="üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º",
                callback_data=f"import_back:{chat_id}",
            )
        ],
    ]

    return InlineKeyboardMarkup(inline_keyboard=buttons)


# ============================================================
# –û–ë–©–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–´
# ============================================================

def create_cancel_keyboard(chat_id: int = None) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã/–Ω–∞–∑–∞–¥.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ FSM –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        chat_id: ID –≥—Ä—É–ø–ø—ã –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã
    """
    if chat_id:
        # –ï—Å–ª–∏ –µ—Å—Ç—å chat_id - –∫–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º (—á–µ—Ä–µ–∑ FSM-aware callback)
        return InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(
                    text="üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º",
                    callback_data=f"import_back:{chat_id}",
                )]
            ]
        )
    else:
        # –ë–µ–∑ chat_id - –ø—Ä–æ—Å—Ç–æ –æ—Ç–º–µ–Ω–∞
        return InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="import_cancel")]
            ]
        )


# ============================================================
# –ö–ù–û–ü–ö–ò –î–õ–Ø –ú–ï–ù–Æ –ù–ê–°–¢–†–û–ï–ö –ì–†–£–ü–ü–´
# ============================================================

def get_export_import_buttons(chat_id: int) -> List[List[InlineKeyboardButton]]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥—Ä—É–ø–ø—ã.

    –≠—Ç–∏ –∫–Ω–æ–ø–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥—Ä—É–ø–ø—ã.

    Args:
        chat_id: ID –≥—Ä—É–ø–ø—ã

    Returns:
        –°–ø–∏—Å–æ–∫ —Ä—è–¥–æ–≤ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    """
    return [
        # –†—è–¥ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞
        [
            InlineKeyboardButton(
                text="üì§ –≠–∫—Å–ø–æ—Ä—Ç",
                callback_data=f"export_select:{chat_id}",
            ),
            InlineKeyboardButton(
                text="üì• –ò–º–ø–æ—Ä—Ç",
                callback_data=f"import_select:{chat_id}",
            ),
        ],
    ]
